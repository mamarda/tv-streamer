{% extends "base.html" %}
{% block content %}
<h1>{{ stream.name }}</h1>

<!-- MJPEG video -->
<img id="mjpeg" src="{{ url_for('mjpeg', stream_id=stream.id) }}" style="max-width: 100%;">

<!-- Audio from HLS (use hls.js outside Safari) -->
<audio id="audio" controls style="width: 100%; margin-top: 8px;"></audio>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
  const audio = document.getElementById('audio');
  const hlsUrl = {{ hls_url|tojson }};

  function playHlsAudio(url) {
    if (audio.canPlayType('application/vnd.apple.mpegURL')) {
      // Safari (native HLS)
      audio.src = url;
      audio.play().catch(()=>{});
    } else if (window.Hls && window.Hls.isSupported()) {
      const hls = new Hls({ enableWorker: true });
      hls.loadSource(url);
      hls.attachMedia(audio);
      hls.on(Hls.Events.MANIFEST_PARSED, () => audio.play().catch(()=>{}));
    } else {
      // Fallback: let browser try anyway
      audio.src = url;
      audio.play().catch(()=>{});
    }
  }
  playHlsAudio(hlsUrl);
</script>
{% endblock %}